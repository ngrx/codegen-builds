!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("fs"),require("path"),require("typescript"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","fs","path","typescript","lodash"],n):n((e.ngrx=e.ngrx||{},e.ngrx.codegen={}),e.fs,e.path,e.typescript,e.lodash)}(this,function(e,n,t,r,i){"use strict";function o(e){return e.members.filter(r.isPropertySignature)}function u(e){var n=o(e).find(function(e){return"type"===e.name.getText()});if(n)return r.isLiteralTypeNode(n.type)?n.type:void 0}function a(e){var n=e.heritageClauses;return!!n&&n.some(function(e){return e.types.some(function(e){return"Action"===e.expression.getText()})})}function c(e){return function(e){return 0!=(r.getCombinedModifierFlags(e)&r.ModifierFlags.Export)}(e)&&function(e){return!!e.parent&&e.parent.kind===r.SyntaxKind.SourceFile}(e)}function f(e,n){var t=n.statements.filter(r.isInterfaceDeclaration).filter(c).filter(a).filter(function(e){return!!u(e)}).map(function(e){return{name:e.name.getText(),actionType:i.trim(u(e).literal.getFullText()," '\"`"),properties:function(e){return e.filter(function(e){return!e.questionToken}).map(function(e){return{name:e.name.getText(),required:!0}}).filter(function(e){return"type"!==e.name})}(o(e)).concat(function(e){return e.filter(function(e){return e.questionToken}).map(function(e){return{name:e.name.getText(),required:!1}})}(o(e)))}});return t.length,[function(e,n){return r.createImportDeclaration(void 0,void 0,r.createImportClause(void 0,r.createNamedImports(n.map(y).map(function(e){return r.createImportSpecifier(void 0,r.createIdentifier(e))}))),r.createIdentifier("'./"+e+"'"))}(e,t),function(e){var n=e[0];return r.createEnumDeclaration(void 0,[r.createToken(r.SyntaxKind.ExportKeyword)],g(n),e.map(function(e){return{prop:w(e),value:m(e)}}).map(function(e){var n=e.prop,t=e.value;return r.createEnumMember(n,r.createLiteral(t))}))}(t),function(e){var n=e[0];return r.createTypeAliasDeclaration(void 0,[r.createToken(r.SyntaxKind.ExportKeyword)],x(n),void 0,r.createUnionTypeNode(e.map(y).map(function(e){return r.createTypeReferenceNode(e,void 0)})))}(t),function(e){var n=e[0];return r.createTypeAliasDeclaration(void 0,[r.createToken(r.SyntaxKind.ExportKeyword)],T(n),void 0,r.createTypeLiteralNode(e.map(function(e){return r.createPropertySignature(void 0,JSON.stringify(m(e)),void 0,r.createTypeReferenceNode(y(e),void 0),void 0)})))}(t)].concat(t.map(function(e){return function(e){return r.createFunctionDeclaration(void 0,[r.createToken(r.SyntaxKind.ExportKeyword)],void 0,b(e),void 0,e.properties.map(function(n){var t=n.name,i=n.required;return r.createParameter(void 0,void 0,void 0,t,i?void 0:r.createToken(r.SyntaxKind.QuestionToken),r.createTypeReferenceNode(y(e)+'["'+t+'"]',void 0),void 0)}),r.createTypeReferenceNode(y(e),void 0),r.createBlock([r.createReturn(r.createObjectLiteral([r.createPropertyAssignment("type",r.createPropertyAccess(r.createIdentifier(g(e)),r.createIdentifier(w(e))))].concat(e.properties.map(function(e){var n=e.name;return r.createShorthandPropertyAssignment(n,void 0)}))))],!0))}(e)}))}function s(e){return new Promise(function(n,t){S(e,{cwd:process.cwd(),ignore:["**/node_modules/**"]},function(e,r){if(e)return t(e);n(r)})})}function p(e){return k(this,void 0,void 0,function(){var i,o,u,a,c,p,d,m,y,v,h,g,w;return l(this,function(x){switch(x.label){case 0:return i=E('Searching for files matching "'+e+'"').start(),[4,s(e)];case 1:o=x.sent(),i.succeed("Found "+o.length+' files for pattern "'+e+'"'),u=0,a=o,x.label=2;case 2:if(!(u<a.length))return[3,8];c=a[u],p=E(c).start(),x.label=3;case 3:return x.trys.push([3,6,,7]),d=t.parse(c),[4,function(e){return k(this,void 0,void 0,function(){return l(this,function(t){return[2,new Promise(function(t,r){n.readFile(e,"utf8",function(e,n){e?r(e):t(n)})})]})})}(c)];case 4:if(m=x.sent(),y=function(e){return r.createSourceFile("",e,r.ScriptTarget.ES2015,!0)}(m),!(v=f(d.name,y)))throw new Error('No actions found for file "'+c+'"');return h=function(e){var n=r.createSourceFile("","",r.ScriptTarget.ES2015,!1,r.ScriptKind.TS),t=r.createPrinter({newLine:r.NewLineKind.LineFeed});return e.map(function(e){return t.printNode(r.EmitHint.Unspecified,e,n)}).join("\n\n")}(v),g=t.resolve(d.dir,"./"+d.name+".helpers.ts"),[4,function(e,t){return k(this,void 0,void 0,function(){return l(this,function(r){return[2,new Promise(function(r,i){n.writeFile(e,t,{encoding:"utf8"},function(e){e?i(e):r()})})]})})}(g,h)];case 5:return x.sent(),p.succeed("Found "+v.length+" actions in "+c),[3,7];case 6:return w=x.sent(),p.fail(w.message),[3,7];case 7:return u++,[3,2];case 8:return[2]}})})}var l=function(e,n){function t(t){return function(u){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[0,o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,u])}}var r,i,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},d=new RegExp(/\[(.*?)\](.*)/),m=function(e){return e.actionType},y=function(e){return e.name},v=i.flow(m,function(e){var n=d.exec(e);if(null===n)throw new Error('Could not parse action type "'+e+'"');return{category:n[1],name:n[2]}},function(e){return e.category}),h=i.flow(v,i.camelCase,i.upperFirst),g=i.flow(h,function(e){return e+"ActionType"}),w=i.flow(y,i.snakeCase,function(e){return e.toUpperCase()}),x=i.flow(h,function(e){return e+"Actions"}),T=i.flow(h,function(e){return e+"ActionLookup"}),b=i.flow(y,i.camelCase,i.upperFirst,function(e){return"create"+e}),S=require("glob"),k=function(e,n,t,r){return new(t||(t=Promise))(function(i,o){function u(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new t(function(n){n(e.value)}).then(u,a)}c((r=r.apply(e,n||[])).next())})},E=require("ora");e.codegen=p,Object.defineProperty(e,"__esModule",{value:!0})});